---
type Card = { title: string; desc: string; href: string; cta: string };

type RecentEvent = {
  title: string;
  tag: string;
  semester: string;
  date: string;
  where: string;
  href: string;
  sortTime: number;
};

type Leader = {
  role: string;
  name: string;
  meta?: string;
  image?: string;
  href?: string;
};

const quickCards: Card[] = [
  {
    title: "Events",
    desc: "Talks, workshops, problem nights, and guest speakers throughout the semester.",
    href: "/events",
    cta: "See events",
  },
  {
    title: "Journal",
    desc: "Student writing and research notes—expository articles welcome.",
    href: "/journal",
    cta: "Read the journal",
  },
  {
    title: "About",
    desc: "What we do, how we run meetings, and how the organization is structured.",
    href: "/about",
    cta: "Learn more",
  },
  {
    title: "Contact",
    desc: "Speaker ideas, collaborations, and general questions.",
    href: "/contact",
    cta: "Get in touch",
  },
];

const base = import.meta.env.BASE_URL;
const withBase = (p: string) =>
  base === "/" ? p : (p.startsWith(base) ? p : base.replace(/\/$/, "") + p);

function fileToRoute(file: string) {
  const norm = file.replaceAll("\\", "/");
  const idx = norm.lastIndexOf("/src/pages/");
  if (idx === -1) return "/events";

  let route = norm.slice(idx + "/src/pages".length); // "/events/..."
  route = route.replace(/\.(md|mdx)$/, "");
  route = route.replace(/\/index$/, "/");
  if (!route.endsWith("/")) route += "/";
  return route;
}

function moduleHref(m: any) {
  if (typeof m.url === "string" && m.url) return withBase(m.url);
  if (m.url?.pathname) return withBase(m.url.pathname);
  if (typeof m.file === "string" && m.file) return withBase(fileToRoute(m.file));
  return withBase("/events");
}

const monthMap: Record<string, number> = {
  jan: 0, january: 0,
  feb: 1, february: 1,
  mar: 2, march: 2,
  apr: 3, april: 3,
  may: 4,
  jun: 5, june: 5,
  jul: 6, july: 6,
  aug: 7, august: 7,
  sep: 8, sept: 8, september: 8,
  oct: 9, october: 9,
  nov: 10, november: 10,
  dec: 11, december: 11,
};

function folderNameFromFile(file: string) {
  const parts = file.replaceAll("\\", "/").split("/");
  return parts.at(-2) ?? ""; // "Spring_2026"
}

function inferSemester(file: string, semester?: string) {
  return semester && semester.trim() ? semester : folderNameFromFile(file).replace(/_/g, " ");
}

function inferYear(file: string, semester?: string) {
  const semYear = semester?.match(/\b(20\d{2})\b/)?.[1];
  if (semYear) return Number(semYear);

  const folderYear = folderNameFromFile(file).match(/_(20\d{2})$/)?.[1];
  if (folderYear) return Number(folderYear);

  return new Date().getFullYear();
}

// dateStr: "Jan 27 · 5:00 PM"
function parseSortTime(dateStr: string, year: number) {
  const parts = dateStr.split("·").map((s) => s.trim());
  const md = parts[0] ?? "Jan 1";
  const time = parts[1] ?? "12:00 AM";

  const [mRaw, dRaw] = md.split(/\s+/);
  const month = monthMap[(mRaw ?? "jan").toLowerCase()] ?? 0;
  const day = Number((dRaw ?? "1").replace(/[^\d]/g, "")) || 1;

  const [t, ampmRaw] = time.split(/\s+/);
  const [hhRaw, mmRaw] = (t ?? "12:00").split(":");
  const ampm = (ampmRaw ?? "AM").toUpperCase();

  let hh = Number(hhRaw) || 12;
  const mm = Number(mmRaw) || 0;
  hh = hh % 12;
  if (ampm === "PM") hh += 12;

  return new Date(year, month, day, hh, mm).getTime();
}

const modules = await Astro.glob("../../pages/events/**/*.md");

const recentEvents: RecentEvent[] = modules
  .map((m: any) => {
    const fm = m.frontmatter ?? {};
    const year = inferYear(m.file, fm.semester);
    const sortTime = parseSortTime(fm.date ?? "Jan 1 · 12:00 AM", year);

    return {
      title: fm.title ?? "Untitled event",
      tag: fm.tag ?? "Event",
      semester: inferSemester(m.file, fm.semester),
      date: fm.date ?? "",
      where: fm.where ?? "",
      href: moduleHref(m),
      sortTime,
    };
  })
  .sort((a, b) => b.sortTime - a.sortTime)
  .slice(0, 3);

// Update these with real names + correct year folders.
// Images: /public/leadership/2026/president.jpg etc.
const leaders: Leader[] = [
  {
    role: "President",
    name: "Erik Hoxhaj",
    meta: "Class of 2028 · Mathematics",
    // image: "/leadership/2026/president.jpg",
    href: "https://www.linkedin.com/in/erikhoxhaj/"
  },
  {
    role: "Vice President",
    name: "Connor Kravatz",
    meta: "Class of 2027 · Mathematics",
    // image: "/leadership/2027/vice-president.jpg",
    href: "https://www.linkedin.com/in/kravatz/"
  },
  {
    role: "Treasurer",
    name: "John Conklin",
    meta: "Class of 2026 · Mathematics",
    // image: "/leadership/2026/treasurer.jpg",
    href:"https://www.linkedin.com/in/john-conklin-b610102b5/"
  },
  {
    role: "Secretary/Head of Tech",
    name: "Joshua Hizgiaev",
    meta: "Class of 2026 · Computer Science",
    // image: "/leadership/2026/treasurer.jpg",
    href: "https://www.linkedin.com/in/joshuahizgiaev/"
  },
  {
    role: "Head of Social Media",
    name: "Kerrissa Arjoon",
    meta: "Class of 2028 · Cyber Security",
    // image: "/leadership/2026/treasurer.jpg",
    href: "https://www.linkedin.com/in/kerrissa-arjoon-b32a822b2/"
  },
  {
    role: "Alumni",
    name: "Ethan Kalika",
    meta: "Class of 2025 · Computer Science",
    // image: "/leadership/2026/treasurer.jpg",
    href: "https://www.linkedin.com/in/ethankalika/"
  }
];
---

<section class="relative overflow-hidden bg-[#fef8ec] dark:bg-[#003049]">
  <!-- soft background blobs -->
  <div class="pointer-events-none absolute inset-0 -z-10">
    <div class="absolute -top-40 left-1/2 h-130 w-130 -translate-x-1/2 rounded-full bg-[#c1121f]/10 blur-3xl"></div>
    <div class="absolute -bottom-48 -right-30 h-105 w-105 rounded-full bg-[#003049]/10 blur-3xl dark:bg-white/10"></div>
  </div>

  <!-- HERO -->
  <div class="mx-auto max-w-6xl px-6 pb-12 pt-14 sm:pb-16 sm:pt-20">
    <div class="max-w-3xl">
      <h1
        class="mt-4 font-serif text-4xl leading-tight text-[#003049] dark:text-[#fef8ec] sm:text-6xl
               ams-reveal ams-d-0"
      >
        Association of Mathematical Sciences
      </h1>

      <p class="mt-4 text-lg text-slate-700 dark:text-[#fef8ec]/80 ams-reveal ams-d-1">
        Talks, problem solving, and student research—organized by students for the Stevens community.
      </p>

      <div class="mt-8 flex flex-wrap gap-3 ams-reveal ams-d-2">
        <a
          href="/events"
          class="inline-flex items-center rounded-xl bg-[#c1121f] px-5 py-3 text-sm font-semibold text-white shadow-sm
                 transition hover:opacity-90"
        >
          View Events
        </a>

        <a
          href="/journal"
          class="inline-flex items-center rounded-xl border border-black/10 bg-white px-5 py-3 text-sm font-semibold text-slate-900 shadow-sm
                 transition hover:bg-slate-50
                 dark:border-white/20 dark:bg-white/10 dark:text-[#fef8ec] dark:hover:bg-white/15"
        >
          Read the Journal
        </a>

        <a
          href="/about"
          class="inline-flex items-center rounded-xl border border-black/10 bg-white px-5 py-3 text-sm font-semibold text-slate-900 shadow-sm
                 transition hover:bg-slate-50
                 dark:border-white/20 dark:bg-white/10 dark:text-[#fef8ec] dark:hover:bg-white/15"
        >
          About AMS
        </a>
      </div>

      <dl class="mt-10 grid grid-cols-1 gap-3 sm:grid-cols-3 ams-reveal ams-d-3">
        <div class="rounded-2xl border border-black/10 bg-white/60 p-4 dark:border-white/20 dark:bg-white/10">
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-[#fef8ec]/70">Focus</dt>
          <dd class="mt-1 font-semibold text-[#003049] dark:text-[#fef8ec]">Community</dd>
        </div>
        <div class="rounded-2xl border border-black/10 bg-white/60 p-4 dark:border-white/20 dark:bg-white/10">
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-[#fef8ec]/70">Programming</dt>
          <dd class="mt-1 font-semibold text-[#003049] dark:text-[#fef8ec]">Talks + Workshops</dd>
        </div>
        <div class="rounded-2xl border border-black/10 bg-white/60 p-4 dark:border-white/20 dark:bg-white/10">
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-[#fef8ec]/70">Journal</dt>
          <dd class="mt-1 font-semibold text-[#003049] dark:text-[#fef8ec]">Student Writing</dd>
        </div>
      </dl>
    </div>
  </div>

  <!-- EXPLORE -->
  <div class="mx-auto max-w-6xl px-6 pb-14">
    <h2 class="font-serif text-2xl text-[#003049] dark:text-[#fef8ec] sm:text-3xl ams-reveal ams-d-0">
      Explore
    </h2>
    <p class="mt-2 max-w-2xl text-slate-700 dark:text-[#fef8ec]/80 ams-reveal ams-d-1">
      Quick links to the parts of the site you'll use most.
    </p>

    <div class="mt-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
      {quickCards.map((c, i) => (
        <a
          href={c.href}
          class:list={[
            "group rounded-2xl border border-black/10 bg-white p-5 shadow-sm transition hover:-translate-y-0.5 hover:bg-slate-50 hover:shadow-md",
            "dark:border-white/20 dark:bg-white/10 dark:hover:bg-white/15",
            "ams-pop",
            i === 0 && "ams-d-0",
            i === 1 && "ams-d-1",
            i === 2 && "ams-d-2",
            i === 3 && "ams-d-3",
          ]}
        >
          <h3 class="font-serif text-lg text-[#003049] dark:text-[#fef8ec]">{c.title}</h3>
          <p class="mt-2 text-sm text-slate-700 dark:text-[#fef8ec]/80">{c.desc}</p>
          <p class="mt-4 text-sm font-semibold text-[#003049] dark:text-[#fef8ec] group-hover:underline">
            {c.cta} →
          </p>
        </a>
      ))}
    </div>
  </div>

  <!-- EVENTS PREVIEW -->
  <div class="mx-auto max-w-6xl px-6 pb-14">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h2 class="font-serif text-2xl text-[#003049] dark:text-[#fef8ec] sm:text-3xl ams-reveal ams-d-0">
          Upcoming events
        </h2>
        <p class="mt-2 text-slate-700 dark:text-[#fef8ec]/80 ams-reveal ams-d-1">
          A preview—see the Events page for full details.
        </p>
      </div>

      <a
        href="/events"
        class="hidden rounded-xl border border-black/10 bg-white px-4 py-2 text-sm font-semibold shadow-sm transition hover:bg-slate-50
               sm:inline-flex
               dark:border-white/20 dark:bg-white/10 dark:text-[#fef8ec] dark:hover:bg-white/15"
      >
        View all
      </a>
    </div>

    <div class="mt-8 grid gap-4 lg:grid-cols-3">
      {recentEvents.map((ev) => (
        <article class="rounded-2xl border border-black/10 bg-white p-5 shadow-sm dark:border-white/20 dark:bg-white/10 ams-pop">
          <div class="flex items-center justify-between gap-3">
            <p class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-[#fef8ec]/70">
              {ev.tag}
            </p>
            <p class="text-xs font-semibold text-slate-600 dark:text-[#fef8ec]/70">
              {ev.semester}
            </p>
          </div>

          <h3 class="mt-2 font-serif text-lg text-[#003049] dark:text-[#fef8ec]">
            {ev.title}
          </h3>

          <p class="mt-2 text-sm text-slate-700 dark:text-[#fef8ec]/80">
            <span class="font-semibold">{ev.date}</span> · {ev.where}
          </p>

          <a href={ev.href} class="mt-4 inline-block text-sm font-semibold text-[#c1121f] hover:underline dark:text-[#fef8ec]">
            Details →
          </a>
        </article>
      ))}
    </div>

    <a
      href="/events"
      class="mt-6 inline-flex rounded-xl border border-black/10 bg-white px-4 py-2 text-sm font-semibold shadow-sm transition hover:bg-slate-50
             sm:hidden
             dark:border-white/20 dark:bg-white/10 dark:text-[#fef8ec] dark:hover:bg-white/15"
    >
      View all events
    </a>
  </div>

  <!-- JOURNAL SPOTLIGHT -->
  <div class="mx-auto max-w-6xl px-6 pb-14">
    <div class="rounded-3xl border border-black/10 bg-white p-6 shadow-sm sm:p-10 dark:border-white/20 dark:bg-white/10 ams-reveal">
      <div class="flex flex-col gap-8 lg:flex-row lg:items-center lg:justify-between">
        <div class="max-w-2xl">
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-[#fef8ec]/70">
            Student journal
          </p>
          <h2 class="mt-2 font-serif text-2xl text-[#003049] dark:text-[#fef8ec] sm:text-3xl">
            Undergraduate writing and research.
          </h2>
          <p class="mt-3 text-slate-700 dark:text-[#fef8ec]/80">
            Expository articles, reading notes, and student research—written for an undergraduate audience.
          </p>

          <div class="mt-6 flex flex-wrap gap-3">
            <a
              href="/journal"
              class="inline-flex items-center rounded-xl bg-[#003049] px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:opacity-90
                     dark:bg-[#fef8ec] dark:text-[#003049]"
            >
              View journal
            </a>
            <a
              href="/contact"
              class="inline-flex items-center rounded-xl border border-black/10 bg-white px-5 py-3 text-sm font-semibold text-slate-900 shadow-sm transition hover:bg-slate-50
                     dark:border-white/20 dark:bg-white/10 dark:text-[#fef8ec] dark:hover:bg-white/15"
            >
              Editorial contact
            </a>
          </div>
        </div>

        <aside class="w-full max-w-sm ams-pop ams-d-1">
          <div class="aspect-4/5 rounded-2xl border border-black/10 bg-[#fef8ec] p-5 text-sm text-slate-700
                      dark:border-white/20 dark:bg-white/10 dark:text-[#fef8ec]/80">
            <p class="font-semibold text-[#003049] dark:text-[#fef8ec]">Featured</p>
            <p class="mt-2">
              Replace this with a journal cover image or a featured article preview card later.
            </p>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- LEADERSHIP -->
  <div class="mx-auto max-w-6xl px-6 pb-20">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h2 class="font-serif text-2xl text-[#003049] dark:text-[#fef8ec] sm:text-3xl ams-reveal ams-d-0">
          Current leadership
        </h2>
        <p class="mt-2 text-slate-700 dark:text-[#fef8ec]/80 ams-reveal ams-d-1">
          For official inquiries, use the Contact page.
        </p>
      </div>

      <a
        href="/about"
        class="hidden text-sm font-semibold text-[#003049] hover:underline sm:inline dark:text-[#fef8ec]
               ams-reveal ams-d-2"
      >
        Learn more →
      </a>
    </div>

    <div class="mt-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {leaders.map((p, i) => (
        <article
          class:list={[
            "group rounded-2xl border border-black/10 bg-white p-5 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md",
            "dark:border-white/20 dark:bg-white/10",
            "ams-pop",
            i % 6 === 0 && "ams-d-0",
            i % 6 === 1 && "ams-d-1",
            i % 6 === 2 && "ams-d-2",
            i % 6 === 3 && "ams-d-3",
            i % 6 === 4 && "ams-d-4",
            i % 6 === 5 && "ams-d-5",
          ]}
        >
          <div class="flex items-start gap-4">
            <a
              href={p.href ?? "/"}
              class="relative h-14 w-14 shrink-0 overflow-hidden rounded-2xl border border-black/10 bg-[#fef8ec] transition
                     group-hover:ring-2 group-hover:ring-[#c1121f]/35 group-hover:ring-offset-2 group-hover:ring-offset-[#fef8ec]
                     dark:border-white/20 dark:bg-white/10
                     dark:group-hover:ring-[#fef8ec]/35 dark:group-hover:ring-offset-[#003049]"
              aria-label={`${p.role}: ${p.name}`}
            >
              <img
                src={p.image ?? "/leadership/placeholder.png"}
                alt={`${p.role}: ${p.name}`}
                loading="lazy"
                class="h-full w-full object-cover transition-transform duration-300 ease-out group-hover:scale-105"
              />
              <span class="pointer-events-none absolute inset-0 bg-black/0 transition group-hover:bg-black/5 dark:group-hover:bg-white/5" />
            </a>

            <div class="min-w-0">
              <p class="text-xs font-semibold uppercase tracking-wide text-slate-600 dark:text-[#fef8ec]/70">
                {p.role}
              </p>
              <h3 class="mt-1 font-serif text-lg text-[#003049] dark:text-[#fef8ec]">
                <a
                  href={p.href ?? "/"}
                  class="inline-block transition group-hover:underline decoration-[#c1121f]/60 underline-offset-4
                         dark:decoration-[#fef8ec]/60"
                >
                  {p.name}
                </a>
              </h3>
              {p.meta && <p class="mt-1 text-sm text-slate-700 dark:text-[#fef8ec]/80">{p.meta}</p>}
            </div>
          </div>
        </article>
      ))}
    </div>

    <a
      href="/about"
      class="mt-6 inline-flex text-sm font-semibold text-[#003049] hover:underline sm:hidden dark:text-[#fef8ec]
             ams-reveal ams-d-2"
    >
      Learn more →
    </a>
  </div>
</section>

